            if(previousPixel[0] == px && previousPixel[1] == py || px >= canvasSize || py >= canvasSize || px < 0 || py < 0) {

is the previousPixel stuff necessary? It might even cause some errors I think. see that part again.